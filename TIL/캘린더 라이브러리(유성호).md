[toc]

# 캘린더 라이브러리

https://github.com/prolificinteractive/material-calendarview

위 라이브러리를 사용해보자.

깃허브에 나온 사용법대로 하면 안된다. 이유는 모름

https://gameprograming.tistory.com/122

위 링크처럼 그냥 옛날 버전을 사용하자.

1. module의 build.gradle에 다음 코드 추가

```
implementation 'com.prolificinteractive:material-calendarview:1.4.3'
```

2. values/colors.xml 에 다음 내용 추가

```xml
    <color name="primary">#448aff</color>
    <color name="primary_light">#83b9ff</color>
    <color name="primary_dark">#005ecb</color>
    <color name="secondary">#3f51b5</color>
    <color name="secondary_ligth">#757de8</color>
    <color name="secondary_dark">#002984</color>
```



3. drawable에 border_radius.xml 추가(테두리 둥글게 꾸미기용)

   ```xml
   <?xml version="1.0" encoding="utf-8"?>
   <shape xmlns:android="http://schemas.android.com/apk/res/android">
       <solid android:color="@color/white" />
       <corners
           android:topLeftRadius="30dp"
           android:topRightRadius="30dp"
           android:bottomRightRadius="0dp"
           android:bottomLeftRadius="0dp" />
   </shape>
   ```



4. 사용하려는 layout에 다음 코드 추가

   ```xml
       <com.prolificinteractive.materialcalendarview.MaterialCalendarView
           android:layout_width="match_parent"
           android:layout_height="match_parent"
           android:background="@drawable/border_radius"/>
   ```

   여기까지 하면 다음과 같은 달력을 그릴 수 있다.

   <img src="캘린더 라이브러리.assets/image-20211102203216504.png" alt="image-20211102203216504" style="zoom:50%;" />

   배경을 회색으로 바꿔서 테두리 바꾼게 표시 나게 했음

   

   여기까지 기본..

   

   

   

   

## 1. 상단 yyyy년 mm월로 표기하기

깃허브 설명을 잘 읽어보면 setTitleFormatter를 사용해서 달력의 년월 표기를 바꿀 수 있다고 한다.

그래서 일단 메인 액티비티의 onCreate function 안에 다음과 같이 작성하였다.

```kotlin
var calendar = findViewById<MaterialCalendarView>(R.id.calendar_view)
// 1. 맨 처음 달력 "yyyy년 yy월"로 표기하기
calendar.setTitleFormatter(TitleFormatter {
    val simpleDateFormat = SimpleDateFormat("yyyy년 MM월", Locale.KOREA)
    simpleDateFormat.format(Date().time)
})
```

이렇게 하면, 맨 처음 현재 달의 달력(지금은 11월 달력)의 상단에 "2021년 11월" 처럼 표시가 된다.

하지만 다른 달로 달력을 넘긴 경우 원래처럼 "11월 2021" 이런 식으로 표현이 된다. 이 문제를 해결하기 위해서는 OnMonthChangedListener 라는 리스너를 달력에 달아주고, onMonthChanged라는 함수를 override 하여 수정해야 한다. 일단 OnMonthChangedListener는 이렇게 생김

```kotlin
public interface OnMonthChangedListener {
    /**
     * Called upon change of the selected day
     *
     * @param widget the view associated with this listener
     * @param date   the month picked, as the first day of the month
     */
    void onMonthChanged(MaterialCalendarView widget, CalendarDay date);
}
```

여기에 접근하려면 MainActivity가 일단 OnMonthChangedListener를 상속받아야 하는 것 같아서 다음과 같이 코드를 작성했다.

```kotlin
class MainActivity : AppCompatActivity(), OnMonthChangedListener {
    
    override fun onCreate(savedInstanceState: Bundle?) {
    	...
        calendar.setOnMonthChangedListener(this) // 달력에 OnMonthChangedListener 달아주기!!
    }
    
    // 1. 달을 바꿨을 때 "yyyy년 yy월" 형태로 표기하기
    override fun onMonthChanged(widget: MaterialCalendarView?, date: CalendarDay?) {
        widget?.setTitleFormatter(TitleFormatter {
            val simpleDateFormat = SimpleDateFormat("yyyy년 MM월", Locale.KOREA)
            simpleDateFormat.format(date?.date?.time)
        })
    }
```

달력에 달이 바뀌면 작동하는 리스너를 달아주고, 그 리스너의 내용을 "yyyy년 MM월"로 타이틀을 바꿔라! 라고 작성한 것.

CalendarDay가 뭔가 했는데.. 마지막 줄 보면 거기서 날짜를 추출해 낼 수 있었다.



**전체 코드**

```kotlin
class MainActivity : AppCompatActivity(), OnMonthChangedListener {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        // 캘린더 레이아웃
        var calendar = findViewById<MaterialCalendarView>(R.id.calendar_view)

        // 1. 맨 처음 달력 "yyyy년 yy월"로 표기하기
        calendar.setTitleFormatter(TitleFormatter {
            val simpleDateFormat = SimpleDateFormat("yyyy년 MM월", Locale.KOREA)
            simpleDateFormat.format(Date().time)
        })

        calendar.setOnMonthChangedListener(this)
    }

    // 1. 달을 바꿨을 때 "yyyy년 yy월" 형태로 표기하기
    override fun onMonthChanged(widget: MaterialCalendarView?, date: CalendarDay?) {
        widget?.setTitleFormatter(TitleFormatter {
            val simpleDateFormat = SimpleDateFormat("yyyy년 MM월", Locale.KOREA)
            simpleDateFormat.format(date?.date?.time)
        })
    }
}
```



## 2. 토/일 색칠하기

Decorator를 사용하여 캘린더를 색칠할 수 있다.



SundayDecorator.kt

```kotlin
class SundayDecorator : DayViewDecorator {
    private val calendar : Calendar = Calendar.getInstance()
    // 일요일이면 true
    override fun shouldDecorate(day: CalendarDay?): Boolean {
        day?.copyTo(calendar)
        val weekDay = calendar.get(Calendar.DAY_OF_WEEK)
        return weekDay == Calendar.SUNDAY
    }
    override fun decorate(view: DayViewFacade?) {
        view?.addSpan(object:ForegroundColorSpan(Color.RED){})
    }
}
```



MainActivity.kt

```kotlin
class MainActivity : AppCompatActivity(), OnMonthChangedListener {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        ...
        
		calendar.addDecorators(SundayDecorator(), SaturdayDecorator())
```



## 3. 날짜에 점 찍기

우선 날짜에 점 찍는걸 event라고 하고 EventDecorator를 만들어야 한다.

EventDecorator.kt

```kotlin
package com.example.materialcalendar

import ...

class EventDecorator(private val color: Int, dates: ArrayList<CalendarDay>?) :
    DayViewDecorator {
    private val dates: HashSet<CalendarDay> = HashSet(dates)
    override fun shouldDecorate(day: CalendarDay): Boolean {
        return dates.contains(day)
    }

    override fun decorate(view: DayViewFacade) {
        view.addSpan(DotSpan(5f, color))
    }
}
```

얘는 CalendarDay를 원소로 가지는 ArrayList인 dates와 원하는 색깔인 color를 입력 받아서 Radius 5의 Dot을 찍어주는 클래스다.

(캘린더의 각 day가 dates에 있으면 decorate에서 점을 찍어주는 것임)



이제 다음 방법으로 확인해 볼 수 있다.

MainActivity.kt

```kotlin
        // 점 찍기 => 여러 날에 표시하려고 days를 구성해서 추가해주는 방식..
        var currentDay = Calendar.getInstance() // 오늘 날짜에 점을 찍겠다면?
        var dates = ArrayList<CalendarDay>() // 점을 찍을 날짜들을 여기에 add로 담아주면 됨
        val day = CalendarDay.from(currentDay) // Calendar 자료형을 넣어주면 됨
        dates.add(day)

        calendar.addDecorator(EventDecorator(Color.RED, dates))
```

원하는 날짜를 Calendar를 이용해서 만들어주고 dates에 추가해준 후 addDecorator를 쓸 때 매개변수로 전달해주면 된다.

<img src="캘린더 라이브러리.assets/image-20211103134849352.png" alt="image-20211103134849352" style="zoom:50%;" />

결과는 위와 같이, 오늘 날짜에 빨간 점이 찍힘!



## 4. 월화수목금토일 색깔 입히기

strings.xml

```xml
<resources>
    <string name="app_name">MaterialCalendar</string>
    <string name="sunday"><font color="#D0312D">일</font></string>
    <string name="saturday"><font color="#3944BC">토</font></string>
    <array name="weekdays_custom">
        <item>@string/sunday</item>
        <item>월</item>
        <item>화</item>
        <item>수</item>
        <item>목</item>
        <item>금</item>
        <item>@string/saturday</item>
    </array>
</resources>
```



activity_main.xml

```xml
app:mcv_weekDayLabels="@array/weekdays_custom"
```

strings.xml에 array 만들고 달력에 바로 적용 가능!



## 5. 누르면 날짜 표시

원하는 Activity에서 OnDateSelectedListener를 상속하고, onDateSelected 함수를 override해서 사용한다.

```kotlin
class MainActivity : AppCompatActivity(), OnMonthChangedListener, OnDateSelectedListener {
    
    override fun onCreate(savedInstanceState: Bundle?) {
        
        ...
        
    	calendar.setOnDateChangedListener(this)
        
        ...
    }
    override fun onDateSelected(
        widget: MaterialCalendarView,
        date: CalendarDay,
        selected: Boolean
    ) {
        var textView = findViewById<TextView>(R.id.calendar_text)
        if (selected) {
         textView.setText(date.toString())
        } else {
            textView.setText("선택 없음")
        }
    }
```

물론 textView는 xml 파일에 그려져 있다.



여기서 주의깊게 봐야할 점은, 날짜를 선택하면 date에 CalendarDay 타입으로 정보가 전달된다는 점!

이걸 이용해서 선택한 날짜를 전달받고, 거기에 맞는 정보를 가져오는 뷰페이저를 만들어야 할 것 같다.

